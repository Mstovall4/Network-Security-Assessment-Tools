#!/usr/bin/python3
import subprocess
import xml.etree.ElementTree as ET
import datetime
import sys

def run_vulnerability_scan(target_ip):
    output_file = f"vuln_scan_{datetime.datetime.now().strftime('%Y%m%d_%H%M%S')}.xml"
    print(f"Starting vulnerability scan of {target_ip}")

    try:
        subprocess.run([
            "nmap", "-sV", "--script", "vuln",
            "-oX", output_file,
            target_ip
        ], check=True)

        tree = ET.parse(output_file)
        root = tree.getroot()

        for host in root.findall("host"):
            for port in host.findall("ports/port"):
                port_id = port.get("portid")
                for script in port.findall("script"):
                    script_id = script.get("id")
                    output = script.get("output")
                    print(f"\nPort {port_id} - Vulnerability Check: {script_id}")
                    print(output)

    except subprocess.CalledProcessError as e:
        print(f"Scan failed: {str(e)}")
    except ET.ParseError as e:
        print(f"Failed to parse results: {str(e)}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: ./vulnerability_scanner.py <target_ip>")
        sys.exit(1)
    run_vulnerability_scan(sys.argv[1])
